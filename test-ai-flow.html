<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaBar AI Flow Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test-case { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }
        .input { color: #0066cc; font-weight: bold; }
        .thinking { color: #ff6600; }
        .toolbox { color: #009900; }
        .response { color: #cc0066; }
        .flow-step { margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 4px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ðŸ¤– MaBar AI Flow Test Cases</h1>
    
    <div class="test-case">
        <h3>Test Case 1: Greeting</h3>
        <button onclick="testCase1()">Test "hello"</button>
        <div id="result1" class="results"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 2: Incomplete Request</h3>
        <button onclick="testCase2()">Test "tomorrow morning"</button>
        <div id="result2" class="results"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 3: Complete Venue Search</h3>
        <button onclick="testCase3()">Test "find courts tomorrow morning kedoya"</button>
        <div id="result3" class="results"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 4: Player Search</h3>
        <button onclick="testCase4()">Test "find players intermediate level tonight"</button>
        <div id="result4" class="results"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 5: No Results</h3>
        <button onclick="testCase5()">Test "find courts 3am sunday"</button>
        <div id="result5" class="results"></div>
    </div>

    <div class="test-case">
        <h3>Test Case 6: Card Interaction</h3>
        <button onclick="testCase6()">Test "join_session:venue_123"</button>
        <div id="result6" class="results"></div>
    </div>

    <script>
        // Mock AI Simple Flow for testing
        class MockAISimpleFlow {
            static async processUserInput(userInput) {
                console.log(`ðŸ‘¤ [USER] ${userInput}`)
                
                // Step 1: AI Thinks
                const aiDecision = await this.mockAIThinks(userInput)
                console.log(`ðŸ§  [AI THINKS] ${aiDecision.reasoning}`)
                
                // Step 2: Toolbox (if needed)
                let data = null
                if (aiDecision.needsData) {
                    data = await this.mockToolboxGetData(aiDecision.dataRequest)
                    console.log(`ðŸ”§ [TOOLBOX] Got ${data?.length || 0} results`)
                }
                
                // Step 3: AI Presents
                const response = await this.mockAIPresents(userInput, aiDecision, data)
                console.log(`ðŸŽ¯ [AI RESPONSE] ${response.text?.substring(0, 50)}...`)
                
                return response
            }

            static async mockAIThinks(userInput) {
                // Mock AI thinking logic
                if (userInput.includes('hello') || userInput.includes('hi')) {
                    return { reasoning: "User is greeting", needsData: false }
                }
                
                if (userInput.includes('tomorrow morning') && !userInput.includes('kedoya')) {
                    return { reasoning: "User wants to play, needs location", needsData: false }
                }
                
                if (userInput.includes('find courts') || userInput.includes('kedoya')) {
                    return {
                        reasoning: "User wants venues",
                        needsData: true,
                        dataRequest: { type: "venues", params: { area: "kedoya" } }
                    }
                }
                
                if (userInput.includes('find players')) {
                    return {
                        reasoning: "User wants to find players",
                        needsData: true,
                        dataRequest: { type: "players", params: { skillLevel: "intermediate" } }
                    }
                }
                
                if (userInput.includes('3am')) {
                    return {
                        reasoning: "User wants courts at unusual time",
                        needsData: true,
                        dataRequest: { type: "venues", params: { time: "3am" } }
                    }
                }
                
                if (userInput.includes('join session')) {
                    return { reasoning: "User wants to join a session", needsData: false }
                }
                
                return { reasoning: "Processing user request", needsData: false }
            }

            static async mockToolboxGetData(dataRequest) {
                // Mock database responses
                if (dataRequest.type === 'venues') {
                    if (dataRequest.params.time === '3am') {
                        return [] // No venues at 3am
                    }
                    return [
                        { name: "Kedoya Sports Center", area: "Kedoya" },
                        { name: "Padel Club Jakarta", area: "Kedoya" },
                        { name: "Elite Courts", area: "Kedoya" }
                    ]
                }
                
                if (dataRequest.type === 'players') {
                    return [
                        { name: "John", skillLevel: "intermediate" },
                        { name: "Sarah", skillLevel: "intermediate" },
                        { name: "Mike", skillLevel: "intermediate" }
                    ]
                }
                
                return null
            }

            static async mockAIPresents(userInput, aiDecision, data) {
                // Mock AI presentation logic
                if (userInput.includes('hello')) {
                    return { text: "Hi! How can I help you with padel today?", sessionCards: [] }
                }
                
                if (userInput.includes('tomorrow morning') && !data) {
                    return { text: "Great! Which area in Jakarta would you prefer?", sessionCards: [] }
                }
                
                if (data && data.length > 0 && aiDecision.dataRequest?.type === 'venues') {
                    return {
                        text: `Found ${data.length} great courts in Kedoya!`,
                        sessionCards: data.slice(0, 3).map(venue => ({
                            type: 'create-new',
                            data: { venue: venue.name, area: venue.area }
                        }))
                    }
                }
                
                if (data && data.length > 0 && aiDecision.dataRequest?.type === 'players') {
                    return {
                        text: `Found ${data.length} intermediate players available!`,
                        sessionCards: [{
                            type: 'existing-session',
                            data: { players: data }
                        }]
                    }
                }
                
                if (data && data.length === 0) {
                    return {
                        text: "No results found. Would you like to try different criteria?",
                        sessionCards: [{ type: 'no-availability', data: { message: 'No results' } }]
                    }
                }
                
                if (userInput.includes('join session')) {
                    return {
                        text: "Great! Processing your request to join the session...",
                        sessionCards: [{ type: 'join-confirmation', data: { status: 'joining' } }]
                    }
                }
                
                return { text: "How can I help you with padel today?", sessionCards: [] }
            }
        }

        function displayResult(resultId, input, response) {
            const resultDiv = document.getElementById(resultId)
            resultDiv.innerHTML = `
                <div class="flow-step input">ðŸ‘¤ [USER] ${input}</div>
                <div class="flow-step thinking">ðŸ§  [AI THINKS] Analyzing user request...</div>
                ${response.toolboxCalled ? '<div class="flow-step toolbox">ðŸ”§ [TOOLBOX] Getting database data...</div>' : ''}
                <div class="flow-step response">ðŸŽ¯ [AI RESPONSE] ${response.text}</div>
                <div class="flow-step">ðŸ“Š Cards: ${response.sessionCards?.length || 0}</div>
            `
        }

        async function testCase1() {
            const input = "hello"
            const response = await MockAISimpleFlow.processUserInput(input)
            displayResult('result1', input, response)
        }

        async function testCase2() {
            const input = "tomorrow morning"
            const response = await MockAISimpleFlow.processUserInput(input)
            displayResult('result2', input, response)
        }

        async function testCase3() {
            const input = "find courts tomorrow morning kedoya"
            const response = await MockAISimpleFlow.processUserInput(input)
            response.toolboxCalled = true
            displayResult('result3', input, response)
        }

        async function testCase4() {
            const input = "find players intermediate level tonight"
            const response = await MockAISimpleFlow.processUserInput(input)
            response.toolboxCalled = true
            displayResult('result4', input, response)
        }

        async function testCase5() {
            const input = "find courts 3am sunday"
            const response = await MockAISimpleFlow.processUserInput(input)
            response.toolboxCalled = true
            displayResult('result5', input, response)
        }

        async function testCase6() {
            const input = "User wants to join session for venue_123"
            const response = await MockAISimpleFlow.processUserInput(input)
            displayResult('result6', 'join_session:venue_123 (card click)', response)
        }
    </script>
</body>
</html>